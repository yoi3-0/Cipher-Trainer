{"ast":null,"code":"import _defineProperty from \"/Users/daniilkurpachenko/Desktop/onewayfunc/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/defineProperty\";\nimport _objectSpread from \"/Users/daniilkurpachenko/Desktop/onewayfunc/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/objectSpread\";\nimport _toConsumableArray from \"/Users/daniilkurpachenko/Desktop/onewayfunc/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/toConsumableArray\";\nimport { SET_PAGE, GO_BACK, OPEN_POPOUT, CLOSE_POPOUT, OPEN_MODAL, CLOSE_MODAL, SET_STORY } from './actionTypes';\nimport * as VK from \"../../services/VK\";\nimport { smoothScrollToTop } from \"../../services/_functions\";\nvar initialState = {\n  activeStory: null,\n  activeView: null,\n  activePanel: null,\n  storiesHistory: [],\n  viewsHistory: [],\n  panelsHistory: [],\n  activeModals: [],\n  modalHistory: [],\n  popouts: [],\n  scrollPosition: []\n};\nexport var routerReducer = function routerReducer() {\n  var state = arguments.length > 0 && arguments[0] !== undefined ? arguments[0] : initialState;\n  var action = arguments.length > 1 ? arguments[1] : undefined;\n\n  switch (action.type) {\n    case SET_PAGE:\n      {\n        var View = action.payload.view;\n        var Panel = action.payload.panel;\n        window.history.pushState(null, null);\n        var panelsHistory = state.panelsHistory[View] || [];\n        var viewsHistory = state.viewsHistory[state.activeStory] || [];\n        var viewIndexInHistory = viewsHistory.indexOf(View);\n\n        if (viewIndexInHistory !== -1) {\n          viewsHistory.splice(viewIndexInHistory, 1);\n        }\n\n        if (panelsHistory.indexOf(Panel) === -1) {\n          panelsHistory = [].concat(_toConsumableArray(panelsHistory), [Panel]);\n        }\n\n        if (panelsHistory.length > 1) {\n          VK.swipeBackOn();\n        }\n\n        return _objectSpread({}, state, {\n          activeView: View,\n          activePanel: Panel,\n          panelsHistory: _objectSpread({}, state.panelsHistory, _defineProperty({}, View, panelsHistory)),\n          viewsHistory: _objectSpread({}, state.viewsHistory, _defineProperty({}, state.activeStory, [].concat(_toConsumableArray(viewsHistory), [View]))),\n          scrollPosition: _objectSpread({}, state.scrollPosition, _defineProperty({}, state.activeStory + \"_\" + state.activeView + \"_\" + state.activePanel, window.pageYOffset))\n        });\n      }\n\n    case SET_STORY:\n      {\n        window.history.pushState(null, null);\n\n        var _viewsHistory = state.viewsHistory[action.payload.story] || [action.payload.story];\n\n        var storiesHistory = state.storiesHistory;\n        var activeView = _viewsHistory[_viewsHistory.length - 1];\n\n        var _panelsHistory = state.panelsHistory[activeView] || [action.payload.initial_panel];\n\n        var activePanel = _panelsHistory[_panelsHistory.length - 1];\n\n        if (action.payload.story === state.activeStory) {\n          if (_panelsHistory.length > 1) {\n            var firstPanel = _panelsHistory.shift();\n\n            _panelsHistory = [firstPanel];\n            activePanel = _panelsHistory[_panelsHistory.length - 1];\n          } else if (_viewsHistory.length > 1) {\n            var firstView = _viewsHistory.shift();\n\n            _viewsHistory = [firstView];\n            activeView = _viewsHistory[_viewsHistory.length - 1];\n            _panelsHistory = state.panelsHistory[activeView];\n            activePanel = _panelsHistory[_panelsHistory.length - 1];\n          }\n        }\n\n        if (action.payload.story === state.activeStory && _panelsHistory.length === 1 && window.pageYOffset > 0) {\n          window.scrollTo(0, 30);\n          smoothScrollToTop();\n        }\n\n        var storiesIndexInHistory = storiesHistory.indexOf(action.payload.story);\n\n        if (storiesIndexInHistory === -1 || storiesHistory[0] === action.payload.story && storiesHistory[storiesHistory.length - 1] !== action.payload.story) {\n          storiesHistory = [].concat(_toConsumableArray(storiesHistory), [action.payload.story]);\n        }\n\n        return _objectSpread({}, state, {\n          activeStory: action.payload.story,\n          activeView: activeView,\n          activePanel: activePanel,\n          storiesHistory: storiesHistory,\n          viewsHistory: _objectSpread({}, state.viewsHistory, _defineProperty({}, activeView, _viewsHistory)),\n          panelsHistory: _objectSpread({}, state.panelsHistory, _defineProperty({}, activeView, _panelsHistory)),\n          scrollPosition: _objectSpread({}, state.scrollPosition, _defineProperty({}, state.activeStory + \"_\" + state.activeView + \"_\" + state.activePanel, window.pageYOffset))\n        });\n      }\n\n    case GO_BACK:\n      {\n        var setView = state.activeView;\n        var setPanel = state.activePanel;\n        var setStory = state.activeStory;\n        var popoutsData = state.popouts;\n\n        if (popoutsData[setView]) {\n          popoutsData[setView] = null;\n          return _objectSpread({}, state, {\n            popouts: _objectSpread({}, state.popouts, {\n              popoutsData: popoutsData\n            })\n          });\n        }\n\n        var viewModalsHistory = state.modalHistory[setView];\n\n        if (viewModalsHistory !== undefined && viewModalsHistory.length !== 0) {\n          var activeModal = viewModalsHistory[viewModalsHistory.length - 2] || null;\n\n          if (activeModal === null) {\n            viewModalsHistory = [];\n          } else if (viewModalsHistory.indexOf(activeModal) !== -1) {\n            viewModalsHistory = viewModalsHistory.splice(0, viewModalsHistory.indexOf(activeModal) + 1);\n          } else {\n            viewModalsHistory.push(activeModal);\n          }\n\n          return _objectSpread({}, state, {\n            activeModals: _objectSpread({}, state.activeModals, _defineProperty({}, setView, activeModal)),\n            modalHistory: _objectSpread({}, state.modalHistory, _defineProperty({}, setView, viewModalsHistory))\n          });\n        }\n\n        var _panelsHistory2 = state.panelsHistory[setView] || [];\n\n        var _viewsHistory2 = state.viewsHistory[state.activeStory] || [];\n\n        var _storiesHistory = state.storiesHistory;\n\n        if (_panelsHistory2.length > 1) {\n          _panelsHistory2.pop();\n\n          setPanel = _panelsHistory2[_panelsHistory2.length - 1];\n        } else if (_viewsHistory2.length > 1) {\n          _viewsHistory2.pop();\n\n          setView = _viewsHistory2[_viewsHistory2.length - 1];\n          var panelsHistoryNew = state.panelsHistory[setView];\n          setPanel = panelsHistoryNew[panelsHistoryNew.length - 1];\n        } else if (_storiesHistory.length > 1) {\n          _storiesHistory.pop();\n\n          setStory = _storiesHistory[_storiesHistory.length - 1];\n          setView = state.viewsHistory[setStory][state.viewsHistory[setStory].length - 1];\n          var _panelsHistoryNew = state.panelsHistory[setView];\n\n          if (_panelsHistoryNew.length > 1) {\n            setPanel = _panelsHistoryNew[_panelsHistoryNew.length - 1];\n          } else {\n            setPanel = _panelsHistoryNew[0];\n          }\n        } else {\n          VK.closeApp();\n        }\n\n        if (_panelsHistory2.length === 1) {\n          VK.swipeBackOff();\n        }\n\n        return _objectSpread({}, state, {\n          activeView: setView,\n          activePanel: setPanel,\n          activeStory: setStory,\n          viewsHistory: _objectSpread({}, state.viewsHistory, _defineProperty({}, state.activeView, _viewsHistory2)),\n          panelsHistory: _objectSpread({}, state.panelsHistory, _defineProperty({}, state.activeView, _panelsHistory2))\n        });\n      }\n\n    case OPEN_POPOUT:\n      {\n        window.history.pushState(null, null);\n        return _objectSpread({}, state, {\n          popouts: _objectSpread({}, state.popouts, _defineProperty({}, state.activeView, action.payload.popout))\n        });\n      }\n\n    case CLOSE_POPOUT:\n      {\n        return _objectSpread({}, state, {\n          popouts: _objectSpread({}, state.popouts, _defineProperty({}, state.activeView, null))\n        });\n      }\n\n    case OPEN_MODAL:\n      {\n        window.history.pushState(null, null);\n\n        var _activeModal = action.payload.id || null;\n\n        var modalsHistory = state.modalHistory[state.activeView] ? _toConsumableArray(state.modalHistory[state.activeView]) : [];\n\n        if (_activeModal === null) {\n          modalsHistory = [];\n        } else if (modalsHistory.indexOf(_activeModal) !== -1) {\n          modalsHistory = modalsHistory.splice(0, modalsHistory.indexOf(_activeModal) + 1);\n        } else {\n          modalsHistory.push(_activeModal);\n        }\n\n        return _objectSpread({}, state, {\n          activeModals: _objectSpread({}, state.activeModals, _defineProperty({}, state.activeView, _activeModal)),\n          modalHistory: _objectSpread({}, state.modalHistory, _defineProperty({}, state.activeView, modalsHistory))\n        });\n      }\n\n    case CLOSE_MODAL:\n      {\n        var _activeModal2 = state.modalHistory[state.activeView][state.modalHistory[state.activeView].length - 2] || null;\n\n        var _modalsHistory = state.modalHistory[state.activeView] ? _toConsumableArray(state.modalHistory[state.activeView]) : [];\n\n        if (_activeModal2 === null) {\n          _modalsHistory = [];\n        } else if (_modalsHistory.indexOf(_activeModal2) !== -1) {\n          _modalsHistory = _modalsHistory.splice(0, _modalsHistory.indexOf(_activeModal2) + 1);\n        } else {\n          _modalsHistory.push(_activeModal2);\n        }\n\n        return _objectSpread({}, state, {\n          activeModals: _objectSpread({}, state.activeModals, _defineProperty({}, state.activeView, _activeModal2)),\n          modalHistory: _objectSpread({}, state.modalHistory, _defineProperty({}, state.activeView, _modalsHistory))\n        });\n      }\n\n    default:\n      {\n        return state;\n      }\n  }\n};","map":{"version":3,"sources":["/Users/daniilkurpachenko/Desktop/onewayfunc/src/js/store/router/reducers.js"],"names":["SET_PAGE","GO_BACK","OPEN_POPOUT","CLOSE_POPOUT","OPEN_MODAL","CLOSE_MODAL","SET_STORY","VK","smoothScrollToTop","initialState","activeStory","activeView","activePanel","storiesHistory","viewsHistory","panelsHistory","activeModals","modalHistory","popouts","scrollPosition","routerReducer","state","action","type","View","payload","view","Panel","panel","window","history","pushState","viewIndexInHistory","indexOf","splice","length","swipeBackOn","pageYOffset","story","initial_panel","firstPanel","shift","firstView","scrollTo","storiesIndexInHistory","setView","setPanel","setStory","popoutsData","viewModalsHistory","undefined","activeModal","push","pop","panelsHistoryNew","closeApp","swipeBackOff","popout","id","modalsHistory"],"mappings":"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","sourcesContent":["import {\n    SET_PAGE,\n    GO_BACK,\n    OPEN_POPOUT,\n    CLOSE_POPOUT,\n    OPEN_MODAL,\n    CLOSE_MODAL,\n    SET_STORY\n} from './actionTypes';\n\nimport * as VK from \"../../services/VK\";\nimport {smoothScrollToTop} from \"../../services/_functions\";\n\nconst initialState = {\n    activeStory: null,\n    activeView: null,\n    activePanel: null,\n\n    storiesHistory: [],\n    viewsHistory: [],\n    panelsHistory: [],\n\n    activeModals: [],\n    modalHistory: [],\n    popouts: [],\n\n    scrollPosition: []\n};\n\nexport const routerReducer = (state = initialState, action) => {\n\n    switch (action.type) {\n\n        case SET_PAGE: {\n            let View = action.payload.view;\n            let Panel = action.payload.panel;\n\n            window.history.pushState(null, null);\n\n            let panelsHistory = state.panelsHistory[View] || [];\n            let viewsHistory = state.viewsHistory[state.activeStory] || [];\n\n            const viewIndexInHistory = viewsHistory.indexOf(View);\n\n            if (viewIndexInHistory !== -1) {\n                viewsHistory.splice(viewIndexInHistory, 1);\n            }\n\n            if (panelsHistory.indexOf(Panel) === -1) {\n                panelsHistory = [...panelsHistory, Panel];\n            }\n\n            if (panelsHistory.length > 1) {\n                VK.swipeBackOn();\n            }\n\n            return {\n                ...state,\n                activeView: View,\n                activePanel: Panel,\n\n                panelsHistory: {\n                    ...state.panelsHistory,\n                    [View]: panelsHistory,\n                },\n                viewsHistory: {\n                    ...state.viewsHistory,\n                    [state.activeStory]: [...viewsHistory, View]\n                },\n                scrollPosition: {\n                    ...state.scrollPosition,\n                    [state.activeStory + \"_\" + state.activeView + \"_\" + state.activePanel]: window.pageYOffset\n                }\n            };\n        }\n\n        case SET_STORY: {\n            window.history.pushState(null, null);\n\n            let viewsHistory = state.viewsHistory[action.payload.story] || [action.payload.story];\n\n            let storiesHistory = state.storiesHistory;\n            let activeView = viewsHistory[viewsHistory.length - 1];\n            let panelsHistory = state.panelsHistory[activeView] || [action.payload.initial_panel];\n            let activePanel = panelsHistory[panelsHistory.length - 1];\n\n            if (action.payload.story === state.activeStory) {\n                if (panelsHistory.length > 1) {\n                    let firstPanel = panelsHistory.shift();\n                    panelsHistory = [firstPanel];\n\n                    activePanel = panelsHistory[panelsHistory.length - 1];\n                } else if (viewsHistory.length > 1) {\n                    let firstView = viewsHistory.shift();\n                    viewsHistory = [firstView];\n\n                    activeView = viewsHistory[viewsHistory.length - 1];\n                    panelsHistory = state.panelsHistory[activeView];\n                    activePanel = panelsHistory[panelsHistory.length - 1];\n                }\n            }\n\n            if (action.payload.story === state.activeStory && panelsHistory.length === 1 && window.pageYOffset > 0) {\n                window.scrollTo(0, 30);\n\n                smoothScrollToTop();\n            }\n\n            const storiesIndexInHistory = storiesHistory.indexOf(action.payload.story);\n\n            if (storiesIndexInHistory === -1 || (storiesHistory[0] === action.payload.story && storiesHistory[storiesHistory.length - 1] !== action.payload.story)) {\n                storiesHistory = [...storiesHistory, action.payload.story];\n            }\n\n            return {\n                ...state,\n                activeStory: action.payload.story,\n                activeView: activeView,\n                activePanel: activePanel,\n\n                storiesHistory: storiesHistory,\n                viewsHistory: {\n                    ...state.viewsHistory,\n                    [activeView]: viewsHistory\n                },\n                panelsHistory: {\n                    ...state.panelsHistory,\n                    [activeView]: panelsHistory\n                },\n\n                scrollPosition: {\n                    ...state.scrollPosition,\n                    [state.activeStory + \"_\" + state.activeView + \"_\" + state.activePanel]: window.pageYOffset\n                }\n            };\n        }\n\n        case GO_BACK: {\n            let setView = state.activeView;\n            let setPanel = state.activePanel;\n            let setStory = state.activeStory;\n\n            let popoutsData = state.popouts;\n\n            if (popoutsData[setView]) {\n                popoutsData[setView] = null;\n\n                return {\n                    ...state,\n                    popouts: {\n                        ...state.popouts, popoutsData\n                    }\n                };\n            }\n\n            let viewModalsHistory = state.modalHistory[setView];\n\n            if (viewModalsHistory !== undefined && viewModalsHistory.length !== 0) {\n                let activeModal = viewModalsHistory[viewModalsHistory.length - 2] || null;\n\n                if (activeModal === null) {\n                    viewModalsHistory = [];\n                } else if (viewModalsHistory.indexOf(activeModal) !== -1) {\n                    viewModalsHistory = viewModalsHistory.splice(0, viewModalsHistory.indexOf(activeModal) + 1);\n                } else {\n                    viewModalsHistory.push(activeModal);\n                }\n\n                return {\n                    ...state,\n                    activeModals: {\n                        ...state.activeModals,\n                        [setView]: activeModal\n                    },\n                    modalHistory: {\n                        ...state.modalHistory,\n                        [setView]: viewModalsHistory\n                    }\n                };\n            }\n\n            let panelsHistory = state.panelsHistory[setView] || [];\n            let viewsHistory = state.viewsHistory[state.activeStory] || [];\n            let storiesHistory = state.storiesHistory;\n\n            if (panelsHistory.length > 1) {\n                panelsHistory.pop();\n\n                setPanel = panelsHistory[panelsHistory.length - 1];\n            } else if (viewsHistory.length > 1) {\n                viewsHistory.pop();\n\n                setView = viewsHistory[viewsHistory.length - 1];\n                let panelsHistoryNew = state.panelsHistory[setView];\n\n                setPanel = panelsHistoryNew[panelsHistoryNew.length - 1];\n            } else if (storiesHistory.length > 1) {\n                storiesHistory.pop();\n\n                setStory = storiesHistory[storiesHistory.length - 1];\n                setView = state.viewsHistory[setStory][state.viewsHistory[setStory].length - 1];\n\n                let panelsHistoryNew = state.panelsHistory[setView];\n\n                if (panelsHistoryNew.length > 1) {\n                    setPanel = panelsHistoryNew[panelsHistoryNew.length - 1];\n                } else {\n                    setPanel = panelsHistoryNew[0];\n                }\n            } else {\n                VK.closeApp();\n            }\n\n            if (panelsHistory.length === 1) {\n                VK.swipeBackOff();\n            }\n\n            return {\n                ...state,\n                activeView: setView,\n                activePanel: setPanel,\n                activeStory: setStory,\n\n                viewsHistory: {\n                    ...state.viewsHistory,\n                    [state.activeView]: viewsHistory\n                },\n                panelsHistory: {\n                    ...state.panelsHistory,\n                    [state.activeView]: panelsHistory\n                }\n            };\n        }\n\n        case OPEN_POPOUT: {\n            window.history.pushState(null, null);\n\n            return {\n                ...state,\n                popouts: {\n                    ...state.popouts,\n                    [state.activeView]: action.payload.popout\n                }\n            };\n        }\n\n        case CLOSE_POPOUT: {\n            return {\n                ...state,\n                popouts: {\n                    ...state.popouts,\n                    [state.activeView]: null\n                }\n            };\n        }\n\n        case OPEN_MODAL: {\n            window.history.pushState(null, null);\n\n            let activeModal = action.payload.id || null;\n            let modalsHistory = state.modalHistory[state.activeView] ? [...state.modalHistory[state.activeView]] : [];\n\n            if (activeModal === null) {\n                modalsHistory = [];\n            } else if (modalsHistory.indexOf(activeModal) !== -1) {\n                modalsHistory = modalsHistory.splice(0, modalsHistory.indexOf(activeModal) + 1);\n            } else {\n                modalsHistory.push(activeModal);\n            }\n\n            return {\n                ...state,\n                activeModals: {\n                    ...state.activeModals,\n                    [state.activeView]: activeModal\n                },\n                modalHistory: {\n                    ...state.modalHistory,\n                    [state.activeView]: modalsHistory\n                }\n            };\n        }\n\n        case CLOSE_MODAL: {\n            let activeModal = state.modalHistory[state.activeView][state.modalHistory[state.activeView].length - 2] || null;\n            let modalsHistory = state.modalHistory[state.activeView] ? [...state.modalHistory[state.activeView]] : [];\n\n            if (activeModal === null) {\n                modalsHistory = [];\n            } else if (modalsHistory.indexOf(activeModal) !== -1) {\n                modalsHistory = modalsHistory.splice(0, modalsHistory.indexOf(activeModal) + 1);\n            } else {\n                modalsHistory.push(activeModal);\n            }\n\n            return {\n                ...state,\n                activeModals: {\n                    ...state.activeModals,\n                    [state.activeView]: activeModal\n                },\n                modalHistory: {\n                    ...state.modalHistory,\n                    [state.activeView]: modalsHistory\n                }\n            };\n        }\n\n        default: {\n            return state;\n        }\n    }\n};\n"]},"metadata":{},"sourceType":"module"}